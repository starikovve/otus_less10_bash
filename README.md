Скрипт использует файл-флаг (lock file) для предотвращения одновременного запуска. Если файл существует, скрипт завершает работу. Команда trap гарантирует удаление этого файла даже в случае ошибки.
Для анализа "с момента последнего запуска" используется файл offset. Скрипт сравнивает количество строк в логе сейчас и сохраненное значение. Если произошла ротация логов (количество строк стало меньше), счетчик сбрасывается. Команда tail вырезает только новый кусок лога во временный файл, чтобы не нагружать систему повторным анализом гигабайтов старых данных.
Для формирования статистики используется awk, который парсит стандартный формат логов (Combined Log Format). Он извлекает IP (поле 1), URL (поле 7) и код ответа (поле 9). Ошибками считаются любые коды, начинающиеся на 4 или 5.

Скриншоты


<img width="795" height="529" alt="image" src="https://github.com/user-attachments/assets/3a945238-6cf6-4163-be85-fb91b11e8d2a" />
<img width="1257" height="797" alt="image" src="https://github.com/user-attachments/assets/5e8c2a15-46ea-4361-85f8-f092299dacfa" />
